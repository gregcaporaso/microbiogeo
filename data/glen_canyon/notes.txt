# We were given an open-ref OTU table, so filter it to only include gg OTUs
# that so we can use the gg tree to compute unifrac, etc.
filter_otus_from_otu_table.py -i otu_table_mc2_1526.biom -o otu_table_w_qiime_db_sample_ids.biom -e ~/.virtualenvs/qiime/data/gg_otus_4feb2011/taxonomies/greengenes_tax.txt --negate_ids_to_exclude

# This table has sample IDs with integers appended to the end (e.g.
# 'S1.12345'), so we need to remove these in order to be consistent with the
# mapping file. Here's the code I used to perform this:

from biom.parse import parse_biom_table
from qiime.format import format_biom_table
t = parse_biom_table(open('otu_table_w_qiime_db_sample_ids.biom', 'U'))
new_samp_ids = []
for samp_id in t.SampleIds:
    sid, inc = samp_id.split('.')
    int(inc)
    new_samp_ids.append(sid)
new_t = t.__class__(t._data.copy(), new_samp_ids, t.ObservationIds[:], t.SampleMetadata, t.ObservationMetadata, t.TableId)
f = open('otu_table.biom', 'w')
f.write(format_biom_table(new_t))
f.close()

# To keep all of the filenames consistent between datasets.
cp map_25Jan2012.txt map.txt
